{% extends "base.html" %}

{% block title %}Forgot Password - LakshyaAI{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/auth.css') }}">
{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-wrapper forgot-password-wrapper">
        <div class="auth-card">
            <div class="auth-header">
                <div class="logo-section">
                    <i class="fas fa-key text-4xl text-blue-600 mb-4"></i>
                    <h1 class="text-3xl font-bold text-gray-900 mb-2">Reset Password</h1>
                    <p class="text-gray-600">Enter your email to receive reset instructions</p>
                </div>
            </div>

            <div class="auth-form active">
                <form method="POST" action="{{ url_for('auth.forgot_password') }}" class="space-y-6">
                    <div class="form-group">
                        <label for="email" class="form-label">
                            <i class="fas fa-envelope mr-2"></i>Email Address
                        </label>
                        <input type="email" id="email" name="email" class="form-input"
                            placeholder="Enter your registered email" value="{{ request.form.email }}" required>
                        <div class="input-feedback"></div>
                        <div class="form-hint">
                            <i class="fas fa-info-circle mr-1"></i>
                            We'll send password reset instructions to this email
                        </div>
                    </div>

                    <button type="submit" class="btn-primary">
                        <i class="fas fa-paper-plane mr-2"></i>
                        Send Reset Link
                    </button>
                </form>

                <div class="auth-links">
                    <a href="{{ url_for('auth.login') }}" class="back-link">
                        <i class="fas fa-arrow-left mr-2"></i>
                        Back to Login
                    </a>
                </div>
            </div>

            <!-- Success Message -->
            <div id="success-message" class="success-card" style="display: none;">
                <div class="success-icon">
                    <i class="fas fa-check-circle text-green-600"></i>
                </div>
                <h3>Email Sent!</h3>
                <p>If an account with that email exists, we've sent password reset instructions.</p>
                <div class="success-actions">
                    <button onclick="resendEmail()" class="btn-secondary">
                        <i class="fas fa-redo mr-2"></i>Resend Email
                    </button>
                    <a href="{{ url_for('auth.login') }}" class="btn-primary">
                        <i class="fas fa-sign-in-alt mr-2"></i>Return to Login
                    </a>
                </div>
            </div>
        </div>

        <div class="auth-info">
            <div class="info-card">
                <h3>Password Reset Help</h3>
                <div class="help-list">
                    <div class="help-item">
                        <i class="fas fa-envelope text-blue-600"></i>
                        <div>
                            <h4>Check Your Email</h4>
                            <p>Reset instructions will be sent within 5 minutes</p>
                        </div>
                    </div>
                    <div class="help-item">
                        <i class="fas fa-spam text-yellow-600"></i>
                        <div>
                            <h4>Check Spam Folder</h4>
                            <p>Sometimes emails end up in spam or junk folders</p>
                        </div>
                    </div>
                    <div class="help-item">
                        <i class="fas fa-clock text-green-600"></i>
                        <div>
                            <h4>Link Expires</h4>
                            <p>Reset links are valid for 24 hours for security</p>
                        </div>
                    </div>
                    <div class="help-item">
                        <i class="fas fa-life-ring text-purple-600"></i>
                        <div>
                            <h4>Need Help?</h4>
                            <p>Contact support if you continue having issues</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
<div id="flash-messages">
    {% for category, message in messages %}
    <div class="alert alert-{{ category }}">
        <span>{{ message }}</span>
        <button onclick="this.parentElement.remove()">
            <i class="fas fa-times"></i>
        </button>
    </div>
    {% endfor %}
</div>
{% endif %}
{% endwith %}
{% endblock %}

{% block extra_js %}
<script>
    function resendEmail() {
        const form = document.querySelector('form');
        const email = document.getElementById('email').value;

        if (email) {
            // Create a new form submission
            const formData = new FormData();
            formData.append('email', email);

            fetch('{{ url_for("auth.forgot_password") }}', {
                method: 'POST',
                body: formData
            }).then(response => {
                if (response.ok) {
                    showNotification('Reset email sent again!', 'success');
                } else {
                    showNotification('Failed to resend email. Please try again.', 'error');
                }
            }).catch(error => {
                showNotification('Network error. Please try again.', 'error');
            });
        }
    }

    function showNotification(message, type) {
        const notification = document.createElement('div');
        notification.className = `alert alert-${type} notification-popup`;
        notification.innerHTML = `
        <span>${message}</span>
        <button onclick="this.parentElement.remove()">
            <i class="fas fa-times"></i>
        </button>
    `;

        document.body.appendChild(notification);

        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 5000);
    }

    // Show success message if form was submitted successfully
    {% if request.method == 'POST' and not get_flashed_messages() %}
    document.addEventListener('DOMContentLoaded', function () {
        document.querySelector('.auth-form').style.display = 'none';
        document.getElementById('success-message').style.display = 'block';
    });
    {% endif %}
</script>
{% endblock %}